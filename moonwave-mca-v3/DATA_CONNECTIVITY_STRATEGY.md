# Moonwave MCA v3.0 데이터 연결성 강화 전략

> **목표**: API Key 없이 활용 가능한 모든 브라우저/웹 기술을 통해 서비스 가치를 극대화
> **원칙**: Zero-API, Zero-Server, 100% Client-Side, Privacy-First

---

## Executive Summary

### 현재 상태 분석

| 영역 | 구현 상태 | 활용도 |
|------|----------|--------|
| IndexedDB 저장소 | ✅ 완료 | 높음 |
| Service Worker | ✅ 완료 | 중간 |
| JSON 내보내기 | ✅ 완료 | 낮음 |
| JSON 가져오기 | ⚠️ 미완성 | 없음 |
| 알림 권한 | ⚠️ 권한만 | 없음 |
| Undo/Redo 히스토리 | ⚠️ DB만 | 없음 |
| 외부 데이터 연동 | ❌ 없음 | 없음 |

### 핵심 기회 영역

```
┌─────────────────────────────────────────────────────────────────┐
│  API Key 없이 활용 가능한 브라우저 기술                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [데이터 공유/전송]          [로컬 데이터 강화]                  │
│  ├── Web Share API           ├── Clipboard API                  │
│  ├── QR Code 생성            ├── File System Access API         │
│  ├── Deep Link / URL State   ├── Drag & Drop API                │
│  └── WebRTC P2P              └── IndexedDB 고급 활용            │
│                                                                 │
│  [사용자 경험 향상]          [분석 및 인사이트]                  │
│  ├── Background Sync         ├── Performance API                │
│  ├── Badge API               ├── 로컬 사용 통계                 │
│  ├── Vibration API           ├── 투자 패턴 분석                 │
│  └── Wake Lock API           └── 시각화 리포트                  │
│                                                                 │
│  [크로스 디바이스]           [문서 생성]                         │
│  ├── Broadcast Channel       ├── PDF 생성 (jsPDF)               │
│  ├── SharedWorker            ├── Excel 내보내기 (SheetJS)       │
│  └── WebRTC DataChannel      └── 인쇄 최적화 뷰                 │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## Part 1: 데이터 공유 및 전송 전략

### 1.1 Web Share API 통합

**기술 개요**: 네이티브 공유 시트를 통해 포트폴리오 데이터를 다른 앱/사용자와 공유

**구현 시나리오**:

```
사용자 플로우:
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│  포트폴리오  │ →  │  공유 버튼  │ →  │  네이티브   │
│  상세 화면  │    │   클릭      │    │  공유 시트  │
└─────────────┘    └─────────────┘    └─────────────┘
                                            │
                    ┌───────────────────────┼───────────────────────┐
                    ↓                       ↓                       ↓
              ┌─────────┐            ┌─────────┐            ┌─────────┐
              │ 카카오톡 │            │  메모   │            │  이메일 │
              │  전송   │            │  저장   │            │  전송   │
              └─────────┘            └─────────┘            └─────────┘
```

**공유 가능한 데이터 형식**:

| 형식 | 용도 | 내용 |
|------|------|------|
| **텍스트 요약** | 빠른 공유 | 종목명, 평단가, 진행률, 수익률 요약 |
| **JSON 파일** | 백업/복원 | 전체 포트폴리오 데이터 |
| **이미지** | SNS 공유 | 차트 스크린샷, 성과 카드 |
| **URL** | 설정 공유 | 파라미터 인코딩된 딥링크 |

**브라우저 지원**: Chrome 89+, Safari 15+, Edge 93+ (Android 완벽 지원, iOS Safari 지원)

**활용 가치**:
- 투자 커뮤니티 내 전략 공유 → 바이럴 마케팅 효과
- 가족/친구 간 백업 데이터 전송
- 투자 일지 기록용 텍스트 자동 생성

---

### 1.2 QR Code 기반 데이터 전송

**기술 개요**: QR 코드를 생성하여 디바이스 간 데이터 전송 (인터넷 불필요)

**아키텍처**:

```
송신 디바이스                           수신 디바이스
┌────────────────┐                    ┌────────────────┐
│   Portfolio    │                    │   QR Scanner   │
│     Data       │                    │    (Camera)    │
│       ↓        │                    │       ↓        │
│   JSON.stringify                    │   JSON.parse   │
│       ↓        │      카메라        │       ↓        │
│   압축 (LZString)  ──────────────→  │   압축 해제    │
│       ↓        │      스캔          │       ↓        │
│   QR 생성      │                    │   데이터 복원  │
│   (qrcode.js)  │                    │                │
└────────────────┘                    └────────────────┘
```

**QR 용량 전략**:

| 데이터 크기 | 전략 | QR 버전 |
|------------|------|---------|
| < 500바이트 | 단일 QR | Version 10 |
| 500B ~ 2KB | 압축 후 단일 QR | Version 20-25 |
| 2KB ~ 10KB | 분할 QR (시퀀스) | 연속 스캔 |
| > 10KB | 파일 전송 권장 | N/A |

**핵심 사용 케이스**:
1. **기기 변경 시 데이터 이전**: 구폰 → 신폰 QR 스캔으로 전체 마이그레이션
2. **친구에게 전략 공유**: 특정 포트폴리오 파라미터만 QR로 공유
3. **오프라인 백업**: QR 코드 인쇄 후 물리적 보관

**라이브러리 선택**:
- 생성: `qrcode` (TypeScript 지원, 5KB gzipped)
- 스캔: `html5-qrcode` (카메라 접근, 35KB gzipped)

---

### 1.3 Deep Link / URL State 인코딩

**기술 개요**: URL 파라미터에 포트폴리오 설정을 인코딩하여 링크 공유

**URL 구조 설계**:

```
기본 구조:
https://mca.moonwave.dev/create?data=<encoded>

인코딩 예시:
원본 데이터:
{
  "name": "삼성전자",
  "peakPrice": 85000,
  "strength": 1.2,
  "startDrop": 15,
  "steps": 20,
  "targetBudget": 10000000
}

URL Safe Base64 인코딩:
/create?d=eyJuIjoi7IKs7ISx7KCE7J6QIiwicCI6ODUwMDAsInMiOjEuMiwi...

단축 파라미터 (용량 최적화):
/create?n=삼성전자&p=85000&s=1.2&d=15&st=20&b=10000000
```

**URL 길이 제약 및 해결책**:

| 플랫폼 | URL 제한 | 해결책 |
|--------|---------|--------|
| 카카오톡 | ~2,000자 | 핵심 파라미터만 인코딩 |
| SMS | ~160자 | 단축 URL 서비스 대신 QR 권장 |
| 이메일 | ~8,000자 | 전체 데이터 인코딩 가능 |
| 브라우저 | ~2,083자 (IE) ~ 무제한 | 브라우저별 분기 처리 |

**활용 시나리오**:
1. **블로그/카페 전략 공유**: "이 링크를 클릭하면 제 MCA 설정이 자동 입력됩니다"
2. **템플릿 배포**: 인기 종목별 추천 설정 링크
3. **북마크 저장**: 자주 사용하는 설정을 브라우저 북마크로 저장

---

### 1.4 WebRTC P2P 데이터 전송 (고급)

**기술 개요**: 서버 없이 브라우저 간 직접 데이터 전송

**아키텍처**:

```
디바이스 A                              디바이스 B
┌────────────┐                        ┌────────────┐
│  MCA App   │                        │  MCA App   │
│     │      │                        │     │      │
│     ↓      │                        │     ↓      │
│ RTCPeerConnection ←───────────────→ RTCPeerConnection
│     │      │     WebRTC             │     │      │
│     ↓      │     DataChannel        │     ↓      │
│ DataChannel│                        │ DataChannel│
└────────────┘                        └────────────┘
        ↑                                    ↑
        └────────── Signaling ───────────────┘
                  (QR Code로 교환)
```

**시그널링 방식 (서버리스)**:

| 방식 | 장점 | 단점 |
|------|------|------|
| **QR 코드 교환** | 완전 오프라인, 서버 불필요 | 양쪽 QR 스캔 필요 |
| **수동 복사** | 구현 간단 | UX 불편 |
| **BroadcastChannel** | 같은 브라우저 탭 간 즉시 | 같은 기기 한정 |

**사용 케이스**:
- 같은 Wi-Fi 내 PC ↔ 모바일 실시간 동기화
- 대용량 백업 데이터 고속 전송 (수십 MB까지)

**구현 복잡도**: 높음 (Phase 3 권장)

---

## Part 2: 로컬 데이터 강화 전략

### 2.1 고급 클립보드 통합

**기술 개요**: 클립보드 API를 활용한 스마트 복사/붙여넣기

**기능 매트릭스**:

| 기능 | 복사 출력 | 붙여넣기 입력 |
|------|----------|--------------|
| **가격 데이터** | "삼성전자 현재가: 72,500원" | 숫자만 추출하여 필드 입력 |
| **포트폴리오 요약** | 텍스트 리포트 | N/A |
| **매매 리스트** | TSV (탭 구분) → Excel 붙여넣기 가능 | Excel에서 복사한 데이터 파싱 |
| **설정 JSON** | 전체 파라미터 JSON | JSON 감지 후 설정 적용 |

**스마트 붙여넣기 플로우**:

```
클립보드 내용 감지
        │
        ├─→ 숫자만? → 현재 포커스된 입력 필드에 적용
        │
        ├─→ JSON 형식? → 포트폴리오 생성/업데이트 제안
        │
        ├─→ TSV/CSV? → 매매 리스트 일괄 입력 제안
        │
        └─→ URL? → 딥링크 파싱 후 설정 적용
```

**활용 가치**:
- 네이버 금융에서 가격 복사 → MCA에 붙여넣기 → 자동 파싱
- Excel에서 작성한 매매 계획 → MCA로 일괄 가져오기
- 텔레그램/카카오톡에서 받은 설정 JSON → 바로 적용

---

### 2.2 File System Access API 활용

**기술 개요**: 로컬 파일 시스템에 직접 읽기/쓰기 (사용자 권한 하에)

**기능**:

```
┌─────────────────────────────────────────────────────────────┐
│  File System Access API 활용 시나리오                        │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  [자동 백업]                                                 │
│  ├── 사용자 지정 폴더에 자동 저장 (예: 문서/MCA백업/)        │
│  ├── 매일 자정 자동 백업 (Background Sync 연계)             │
│  └── 버전 관리 (날짜별 파일명)                              │
│                                                             │
│  [파일 감시 동기화]                                          │
│  ├── 지정 폴더 변경 감지 (File System Observer)             │
│  ├── 다른 앱에서 수정 시 자동 반영                           │
│  └── Dropbox/OneDrive 폴더 지정 → 클라우드 동기화 효과       │
│                                                             │
│  [드래그 앤 드롭 향상]                                       │
│  ├── 파일 드래그 → 바로 가져오기                            │
│  ├── 폴더 드래그 → 일괄 가져오기                            │
│  └── 내보내기 시 폴더 선택 UI                               │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

**브라우저 지원**: Chrome 86+, Edge 86+ (Safari, Firefox 미지원 → 폴백 필요)

**핵심 이점**:
- 기존 클라우드 서비스(Dropbox, OneDrive, iCloud Drive) 활용한 "무료 동기화"
- 파일 탐색기에서 직접 백업 파일 관리

---

### 2.3 Drag & Drop 고도화

**기술 개요**: 드래그 앤 드롭으로 데이터 입력 UX 혁신

**지원 드롭 타입**:

| 드롭 소스 | 처리 방식 | 결과 |
|----------|----------|------|
| **JSON 파일** | 포트폴리오 복원 | 가져오기 완료 |
| **Excel 파일** | 매매 리스트 파싱 | 일괄 입력 |
| **이미지 파일** | 종목 아이콘 설정 | 커스텀 아이콘 |
| **텍스트 선택** | 숫자/JSON 감지 | 스마트 입력 |
| **URL** | 딥링크 파싱 | 설정 적용 |

**드롭존 UX**:

```
┌─────────────────────────────────────────────────────────────┐
│  ┌─────────────────────────────────────────────────────┐   │
│  │                                                     │   │
│  │        📁 파일을 여기에 드래그하세요               │   │
│  │                                                     │   │
│  │   지원 형식: JSON, Excel (.xlsx), CSV               │   │
│  │                                                     │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  드래그 중 시각 피드백:                                      │
│  - 테두리 색상 변경 (Primary Blue)                          │
│  - 배경 오버레이                                            │
│  - 아이콘 애니메이션                                        │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

### 2.4 IndexedDB 고급 활용

**현재 상태**: 기본 CRUD만 구현

**확장 전략**:

```typescript
// 1. 가격 히스토리 테이블 추가
priceHistory: '++id, portfolioId, date, price, source'

// 2. 사용자 활동 로그
activityLog: '++id, timestamp, action, portfolioId, details'

// 3. 캐시된 계산 결과
calculationCache: 'portfolioId, hash, result, calculatedAt'

// 4. 사용자 정의 템플릿
templates: '++id, name, params, createdAt, usageCount'
```

**고급 쿼리 활용**:

| 기능 | 쿼리 패턴 | 용도 |
|------|----------|------|
| **최근 활동** | `activityLog.where('timestamp').above(weekAgo)` | 대시보드 타임라인 |
| **자주 쓰는 설정** | `templates.orderBy('usageCount').reverse()` | 템플릿 추천 |
| **가격 추세** | `priceHistory.where('portfolioId').equals(id)` | 미니 차트 |
| **데이터 정리** | `history.where('timestamp').below(monthAgo).delete()` | 자동 정리 |

---

## Part 3: 사용자 경험 향상 기술

### 3.1 Background Sync API

**기술 개요**: 오프라인에서 수행한 작업을 온라인 복귀 시 자동 처리

**MCA 활용 시나리오**:

```
오프라인 상황                    온라인 복귀
┌────────────────┐             ┌────────────────┐
│  체결 버튼 클릭 │             │  Background    │
│       ↓        │             │  Sync 트리거   │
│  IndexedDB 저장│             │       ↓        │
│       ↓        │  ────────→  │  파일 내보내기 │
│  Sync Queue에  │             │  (자동 백업)   │
│  작업 등록     │             │       ↓        │
│       ↓        │             │  알림 표시     │
│  "동기화 대기" │             │  "백업 완료"   │
└────────────────┘             └────────────────┘
```

**활용 기능**:
1. **오프라인 매매 기록 → 온라인 시 자동 백업 파일 생성**
2. **대시보드 데이터 프리페칭**
3. **PWA 업데이트 체크 및 알림**

---

### 3.2 Badge API (앱 뱃지)

**기술 개요**: PWA 아이콘에 숫자 뱃지 표시

**활용 시나리오**:

```
홈 화면 아이콘
┌─────────────┐
│             │
│    MCA      │  ← 앱 아이콘
│             │
│         🔴3 │  ← 뱃지: "3개 구간 추가 주문 필요"
└─────────────┘
```

**뱃지 트리거 조건**:

| 조건 | 뱃지 값 | 의미 |
|------|--------|------|
| 주문 갭 발생 | 갭 구간 수 | "3개 구간 추가 주문 필요" |
| 백업 필요 | 1 | "7일 이상 백업 안 함" |
| 새 기능 알림 | 1 | "업데이트 확인" |

**브라우저 지원**: Chrome 81+, Edge 81+ (PWA 설치 시)

---

### 3.3 Vibration API (햅틱 피드백)

**기술 개요**: 모바일 기기에서 진동으로 피드백 제공

**활용 패턴**:

```javascript
// 체결 완료 - 긍정적 피드백
navigator.vibrate([50, 30, 50]); // 짧은 더블 탭

// 경고 - 주의 환기
navigator.vibrate([100, 50, 100, 50, 100]); // 세 번 진동

// 에러 - 강한 피드백
navigator.vibrate(200); // 긴 단일 진동
```

**적용 위치**:
- 체결 체크박스 토글
- 포트폴리오 삭제 확인
- 주문 갭 경고

---

### 3.4 Wake Lock API

**기술 개요**: 화면 자동 꺼짐 방지

**활용 시나리오**:
- 매매 리스트 보면서 증권앱에서 주문 입력 중 → 화면 꺼짐 방지
- 차트 분석 중 장시간 화면 유지

```javascript
// 상세 페이지 진입 시 활성화
const wakeLock = await navigator.wakeLock.request('screen');

// 페이지 이탈 시 해제
wakeLock.release();
```

---

## Part 4: 분석 및 인사이트 전략

### 4.1 로컬 사용 통계 시스템

**기술 개요**: 서버 없이 사용자 행동 분석

**수집 데이터 (로컬 저장)**:

```typescript
interface UsageStats {
  // 일별 통계
  dailyStats: {
    date: string;
    appOpens: number;
    portfolioViews: number;
    tradesExecuted: number;
    totalTimeSpent: number; // 초 단위
  }[];

  // 포트폴리오별 통계
  portfolioStats: Map<number, {
    viewCount: number;
    lastViewed: Date;
    modificationCount: number;
    executionRate: number; // 체결률
  }>;

  // 기능 사용 빈도
  featureUsage: {
    autoFit: number;
    export: number;
    share: number;
    chartView: number;
  };
}
```

**인사이트 대시보드**:

```
┌─────────────────────────────────────────────────────────────┐
│  📊 나의 투자 활동 분석                                      │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  이번 주 활동                                                │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  앱 사용: 12회  |  체결 구간: 8개  |  총 시간: 2.5시간 │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                             │
│  가장 많이 본 종목: NAVER (23회)                             │
│  가장 활발한 종목: LG전자 (체결률 45%)                       │
│  평균 세션 시간: 12분                                        │
│                                                             │
│  💡 인사이트                                                 │
│  "NAVER 종목의 주문 갭이 3구간 발생했습니다.                  │
│   현재가 기준 추가 주문을 검토해보세요."                      │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

### 4.2 투자 패턴 분석

**분석 항목**:

| 분석 | 계산 방식 | 인사이트 |
|------|----------|----------|
| **체결 속도** | 첫 주문 ~ 마지막 체결 기간 | "평균 45일 만에 전 구간 체결" |
| **주문 습관** | 주문 시간대 분포 | "주로 오전 9-10시에 주문" |
| **구간 선호도** | 자주 체결되는 구간 | "1-5구간 체결률 높음 (하락 초기)" |
| **파라미터 성향** | 강도/구간 평균 | "공격적 투자 성향 (강도 1.5 이상)" |

**시각화 제안**:
- 히트맵: 요일/시간대별 활동량
- 선 그래프: 월별 체결 금액 추이
- 파이 차트: 종목별 투자 비중
- 막대 그래프: 구간별 체결 빈도

---

### 4.3 Performance API 활용

**기술 개요**: 앱 성능 지표 수집 및 분석

**수집 지표**:

```javascript
// 페이지 로드 성능
const [navigation] = performance.getEntriesByType('navigation');
const pageLoadTime = navigation.loadEventEnd - navigation.startTime;

// 계산 성능
const calcStart = performance.now();
calculateTrades(params, ordered, executed);
const calcDuration = performance.now() - calcStart;

// 메모리 사용량 (Chrome only)
const memory = performance.memory?.usedJSHeapSize;
```

**활용**:
- 대용량 포트폴리오 시 성능 경고
- 브라우저별 최적화 힌트 제공
- 느린 계산 시 Web Worker 전환 제안

---

## Part 5: 문서 생성 전략

### 5.1 PDF 리포트 생성

**기술 개요**: jsPDF를 활용한 투자 리포트 PDF 생성

**리포트 구조**:

```
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│  🌙 Moonwave MCA 투자 리포트                                │
│  생성일: 2025-01-23                                         │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  포트폴리오: NAVER                                          │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 파라미터 요약                                        │   │
│  │ 고점가: 262,500원 | 강도: 1.2 | 구간: 20            │   │
│  │ 목표예산: 5억원 | 시작하락률: -15%                   │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ [평단가 방어선 차트 - Canvas to Image]               │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 매매 리스트 (테이블)                                 │   │
│  │ 구간 | 하락률 | 매수가 | 수량 | 금액 | 상태         │   │
│  │  1   | -15%  | 223K  |  3  | 669K | ✓ 체결        │   │
│  │ ...                                                 │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  생성: Moonwave MCA v3.0                                    │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

**기술 스택**:
- **jsPDF**: PDF 생성 (핵심 라이브러리)
- **html2canvas**: 차트를 이미지로 변환
- **jspdf-autotable**: 테이블 레이아웃

---

### 5.2 Excel 내보내기 (SheetJS)

**기술 개요**: SheetJS를 활용한 Excel 파일 생성

**내보내기 시트 구조**:

| 시트명 | 내용 |
|--------|------|
| **요약** | 포트폴리오 파라미터, 현재 상태 |
| **매매 리스트** | 전체 구간별 상세 데이터 |
| **히스토리** | 체결 이력 (날짜, 가격, 수량) |
| **분석** | 통계, 차트 데이터 |

**셀 서식**:
- 통화: ₩#,##0
- 퍼센트: 0.00%
- 날짜: YYYY-MM-DD
- 조건부 서식: 체결(녹색), 주문(노랑)

---

### 5.3 인쇄 최적화 뷰

**기술 개요**: CSS @media print를 활용한 인쇄용 레이아웃

**인쇄 최적화 항목**:

```css
@media print {
  /* 불필요 요소 숨김 */
  .no-print, nav, footer, .sidebar { display: none; }

  /* 배경색 제거 (잉크 절약) */
  * { background: white !important; }

  /* 테이블 페이지 나눔 방지 */
  table { page-break-inside: avoid; }

  /* 차트 크기 조정 */
  .chart-container { width: 100%; height: auto; }

  /* 폰트 크기 조정 */
  body { font-size: 12pt; }
}
```

---

## Part 6: 크로스 디바이스 전략

### 6.1 Broadcast Channel API

**기술 개요**: 같은 브라우저 내 여러 탭 간 실시간 동기화

**활용**:

```
탭 1 (대시보드)                   탭 2 (상세 페이지)
┌────────────────┐               ┌────────────────┐
│  포트폴리오    │               │  NAVER 상세    │
│  목록 표시     │               │                │
│                │               │  [체결 클릭]   │
│                │  ←──────────  │       ↓        │
│  자동 갱신! ✓  │  Broadcast    │  상태 변경     │
│                │  Channel      │                │
└────────────────┘               └────────────────┘
```

**동기화 이벤트**:
- 포트폴리오 CRUD
- 체결/주문 상태 변경
- 설정 변경
- 테마 변경

---

### 6.2 SharedWorker 활용

**기술 개요**: 여러 탭에서 공유하는 단일 Worker

**장점**:
- 메모리 효율성 (Worker 하나만 실행)
- 데이터 일관성 보장
- 계산 결과 캐싱 공유

**아키텍처**:

```
┌─────┐ ┌─────┐ ┌─────┐
│Tab 1│ │Tab 2│ │Tab 3│
└──┬──┘ └──┬──┘ └──┬──┘
   │       │       │
   └───────┼───────┘
           │
    ┌──────┴──────┐
    │SharedWorker │
    │             │
    │ - DB 접근   │
    │ - 계산 캐시 │
    │ - 상태 관리 │
    └─────────────┘
```

---

## Part 7: 수동 가격 입력 강화

### 7.1 스마트 가격 입력 시스템

**API 없이 가격 데이터 품질 향상 전략**:

```
┌─────────────────────────────────────────────────────────────┐
│  스마트 가격 입력 시스템                                     │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  [입력 보조]                                                 │
│  ├── 최근 입력 가격 자동완성                                │
│  ├── 호가 단위 자동 보정 (틱 사이즈)                        │
│  ├── 합리적 범위 검증 (±30% 경고)                           │
│  └── 복사/붙여넣기 숫자 자동 파싱                           │
│                                                             │
│  [히스토리 활용]                                             │
│  ├── 종목별 가격 입력 히스토리 저장                         │
│  ├── 트렌드 시각화 (미니 스파크라인)                        │
│  ├── 이전 대비 변동률 표시                                  │
│  └── 52주 고/저 기준 위치 표시                              │
│                                                             │
│  [커뮤니티 기반 (향후)]                                      │
│  ├── 익명 가격 데이터 공유 (옵트인)                         │
│  ├── 사용자 간 가격 검증                                    │
│  └── 크라우드소싱 가격 DB 구축                              │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 7.2 가격 히스토리 로컬 DB

**스키마 확장**:

```typescript
interface PriceEntry {
  id?: number;
  portfolioId: number;
  stockName: string;
  date: string;        // YYYY-MM-DD
  price: number;
  source: 'manual' | 'clipboard' | 'import';
  createdAt: Date;
}

// IndexedDB 테이블
priceHistory: '++id, portfolioId, stockName, date'
```

**활용**:
- 고점 대비 현재 하락률 자동 계산
- 가격 추세 미니 차트
- 이상치 감지 (급등락 경고)

---

## Part 8: 구현 우선순위 로드맵

### Phase 1: 핵심 연결성 (즉시 구현 가능)

| 기능 | 복잡도 | 임팩트 | 의존성 |
|------|--------|--------|--------|
| Web Share API 통합 | 낮음 | 높음 | 없음 |
| 클립보드 스마트 붙여넣기 | 낮음 | 중간 | 없음 |
| Drag & Drop 파일 가져오기 | 낮음 | 중간 | 없음 |
| JSON 가져오기 완성 | 낮음 | 높음 | 없음 |
| Broadcast Channel 탭 동기화 | 중간 | 중간 | 없음 |

**예상 개발 기간**: 3-5일

### Phase 2: 문서 및 분석 (중기)

| 기능 | 복잡도 | 임팩트 | 의존성 |
|------|--------|--------|--------|
| Excel 내보내기 (SheetJS) | 중간 | 높음 | 라이브러리 |
| PDF 리포트 생성 | 중간 | 중간 | jsPDF, html2canvas |
| 로컬 사용 통계 | 중간 | 중간 | DB 스키마 확장 |
| 인쇄 최적화 CSS | 낮음 | 낮음 | 없음 |
| Badge API 알림 뱃지 | 낮음 | 중간 | 없음 |

**예상 개발 기간**: 5-7일

### Phase 3: 고급 연결성 (장기)

| 기능 | 복잡도 | 임팩트 | 의존성 |
|------|--------|--------|--------|
| QR Code 데이터 전송 | 중간 | 높음 | qrcode, html5-qrcode |
| Deep Link URL 상태 | 중간 | 중간 | URL 라우팅 |
| File System Access API | 높음 | 중간 | 브라우저 제한 |
| 가격 히스토리 시스템 | 중간 | 높음 | DB 스키마 |
| 투자 패턴 분석 | 높음 | 중간 | 통계 로직 |

**예상 개발 기간**: 7-10일

### Phase 4: 실험적 기능 (선택적)

| 기능 | 복잡도 | 임팩트 | 리스크 |
|------|--------|--------|--------|
| WebRTC P2P 동기화 | 매우 높음 | 중간 | 시그널링 복잡 |
| SharedWorker | 높음 | 낮음 | 브라우저 지원 |
| Wake Lock API | 낮음 | 낮음 | 배터리 소모 |
| Background Sync | 중간 | 중간 | SW 복잡도 |

**예상 개발 기간**: 필요시 개별 검토

---

## Part 9: 기술 의사결정 매트릭스

### 라이브러리 선정

| 기능 | 라이브러리 | 크기 (gzip) | 대안 |
|------|-----------|-------------|------|
| QR 생성 | qrcode | 5KB | qr-code-styling (스타일링) |
| QR 스캔 | html5-qrcode | 35KB | jsQR (가볍지만 기능 제한) |
| Excel | SheetJS (xlsx) | 90KB | exceljs (스트리밍 지원) |
| PDF | jsPDF | 50KB | pdfmake (선언적 문법) |
| 압축 | lz-string | 3KB | pako (더 강력한 압축) |
| 차트→이미지 | html2canvas | 40KB | 내장 (canvas.toDataURL) |

### 브라우저 지원 매트릭스

| API | Chrome | Safari | Firefox | Edge | 폴백 |
|-----|--------|--------|---------|------|------|
| Web Share | ✅ 89+ | ✅ 15+ | ❌ | ✅ 93+ | 복사 링크 |
| File System Access | ✅ 86+ | ❌ | ❌ | ✅ 86+ | 일반 다운로드 |
| Badge API | ✅ 81+ | ❌ | ❌ | ✅ 81+ | 제목 변경 |
| Broadcast Channel | ✅ 54+ | ✅ 15.4+ | ✅ 38+ | ✅ 79+ | localStorage 이벤트 |
| Clipboard API | ✅ 66+ | ✅ 13.1+ | ✅ 63+ | ✅ 79+ | execCommand |
| Vibration | ✅ 32+ | ❌ | ✅ 16+ | ✅ 79+ | 무시 |

---

## Part 10: 성과 지표 (KPIs)

### 연결성 기능 성과 측정

| 지표 | 측정 방법 | 목표 |
|------|----------|------|
| **공유 전환율** | 공유 버튼 클릭 / 상세 페이지 뷰 | > 5% |
| **가져오기 성공률** | 성공 가져오기 / 시도 | > 95% |
| **내보내기 사용률** | 내보내기 / 월 활성 사용자 | > 20% |
| **탭 동기화 활용** | 다중 탭 세션 비율 | > 10% |
| **QR 전송 완료율** | 성공 스캔 / QR 생성 | > 80% |
| **PDF 생성 수** | 월별 PDF 다운로드 | > 100 |

### 사용자 만족도 지표

| 지표 | 측정 방법 | 목표 |
|------|----------|------|
| **데이터 유실 민원** | 복원 관련 문의 | 0건/월 |
| **백업 활성 사용자** | 최근 30일 내보내기 | > 50% |
| **재설치 데이터 복원** | 설치 후 가져오기 성공 | > 70% |

---

## 결론 및 권장사항

### 즉시 실행 권장 (Quick Wins)

1. **Web Share API 통합** - 바이럴 효과 + 구현 간단
2. **JSON 가져오기 완성** - 기존 코드 완성만 필요
3. **클립보드 스마트 입력** - 사용자 편의성 대폭 향상
4. **Broadcast Channel** - 다중 탭 UX 개선

### 중기 투자 권장

1. **Excel 내보내기** - 증권사/세무 연동 니즈 충족
2. **QR Code 전송** - 차별화된 UX + 바이럴 마케팅
3. **가격 히스토리** - 데이터 품질 향상 기반

### 핵심 메시지

> **"API Key 없이도 풍부한 연결성 경험이 가능합니다."**
>
> 브라우저 네이티브 API만으로도:
> - 디바이스 간 데이터 전송 (QR, P2P)
> - 다른 앱과 데이터 공유 (Web Share, 클립보드)
> - 클라우드 효과 (File System + Dropbox 폴더)
> - 전문 리포트 생성 (PDF, Excel)
>
> 이러한 기능들은 서버 비용 없이 완전한 클라이언트 사이드에서 구현 가능하며,
> 사용자 데이터 프라이버시를 100% 보장합니다.

---

*문서 버전: 1.0*
*작성일: 2025-01-23*
*작성: Claude Opus 4.5*
